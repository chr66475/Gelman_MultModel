"0",""
"0","# Pulling out response and predictors. See book section 12.2 for specifics."
"0",""
"0","### Only interested in state = MN. Log response."
"0",""
"0",""
"0","mn <- raw_radon_srrs2$state==""MN"""
"0","radon <- raw_radon_srrs2$activity[mn]"
"0","log.radon <- log (ifelse (radon==0, .1, radon)) # Replaces any 0 with 0.1 so that a log transformation can be performed."
"0","floor <- raw_radon_srrs2$floor[mn]       # 0 for basement, 1 for first floor"
"0","n <- length(radon)"
"0","y <- log.radon"
"0","x <- floor"
"0","  "
"0",""
"0","# get county index variable"
"0","county.name <- as.vector(raw_radon_srrs2$county[mn]) # Pulls a list of each county name."
"0","uniq <- unique(county.name) # Reduces the list to non-repeats."
"0","J <- length(uniq) # Gets the number of unique counties."
"0","county <- rep (NA, J) # Creates a new vector county of length J filled with NA values. This vector will be used to store numerical codes for each county."
"0","for (i in 1:J){"
"0","  county[county.name==uniq[i]] <- i"
"0","} # Loop that assigns a unique numerical code (from 1 to J) to each county. It iterates through the unique county names and, for each name, assigns the corresponding code (i) to all elements in the county vector where county.name matches that unique name."
"0",""
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# no predictors"
"0","ybarbar = mean(y) # Gets the mean of 'y' which is the log of radon levels. Provides a baseline measure of radon levels."
"0",""
"0","sample.size <- as.vector (table (county)) # Pulls the number of observations for each county. and creates a table of county for each county and converts it to a vector. "
"0","sample.size.jittered <- sample.size*exp (runif (J, -.1, .1)) # Adds some random jitter to sample size."
"0","cty.mns = tapply(y,county,mean) # Gets mean of log-trans radon levels for each county."
"0","cty.vars = tapply(y,county,var) # Gets variance of log-transformed radon levels for each county."
"0","cty.sds = mean(sqrt(cty.vars[!is.na(cty.vars)]))/sqrt(sample.size) # Estimates the standard deviation of county-level means. First, calculates the square root of the variances (standard deviations) for each county, excluding NA values. Takes the mean of these standard deviations and divides it by the square root of sample size of each county. Provides estimate of variability between counties."
"0","cty.sds.sep = sqrt(tapply(y,county,var)/sample.size) # Calculates the standard deviation of log-transformed radon levels within each county. Divides the county-specific variances by the corresponding sample sizes and takes the square root. This provides an estiamte of hte variability within each county."
"0",""
"0"," # varying-intercept model, no predictors"
"0",""
"0","radon.data <- list (""n"", ""J"", ""y"", ""county"")"
"0","radon.inits <- function (){"
"0","  list (a=rnorm(J), mu.a=rnorm(1),"
"0","        sigma.y=runif(1), sigma.a=runif(1))"
"0","} # Defines a function that generates initial values for the model parameters and creates a list with the values: 1. a(vector of random normal values for county-specific effects - J values). 2. mu.a(Sing random value for the mean of the county effects). 3. sigma.y(Single random uniform value for the standard deviation of the radon measurements within counties). sigma.a(Single random uniform value for the standard deviation of the county effects)."
"0",""
"0","radon.parameters <- c (""a"", ""mu.a"", ""sigma.y"", ""sigma.a"") # Specifies the name of the parameters to be monitored and returned by the model. These are the same parameters for which initial values were defined."
"0",""
"0",""
"0","BUGS_DIR <- ""C:/Users/conno/OneDrive - University of Georgia/Amy_Connor_Zambia/Gelman_MultilevelModeling/Gelman_MultModel/code/radon.multilevel.nopred.txt"""
"0",""
"0",""
"0","mlm.radon.nopred <- bugs (radon.data, radon.inits, radon.parameters,  n.chains=3, "
"0"," ""radon.multilevel.nopred.txt"", bugs.directory=BUGS_DIR,"
"0","    working.directory=NULL, clearWD=TRUE, n.iter=10, debug=TRUE) # Calls the bugs function to run the Bayesian multilevel model. radon.data are the list of data for the model. radon.inits is the function to generate initial values. radon.parameters is the vector of parameter names to monitor. n.chaims = 3 is the number of MCMC chains to run. radon.multilevel.nopred.bu is the name of the WinBUGS model file"
"2","Error in bugs(radon.data, radon.inits, radon.parameters, n.chains = 3,  : 
  could not find function ""bugs""
"
